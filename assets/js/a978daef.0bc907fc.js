"use strict";(self.webpackChunkelemental_docs=self.webpackChunkelemental_docs||[]).push([[8288],{49225:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>d});var i=t(74848),o=t(28453);const r='name: Static nm-configurator config\nstages:\n  initramfs:\n  - directories:\n      - path: /tmp/nmc/static/desired-states\n        permissions: 448\n        owner: 0\n        group: 0\n      - path: /tmp/nmc/static/network-config\n        permissions: 448\n        owner: 0\n        group: 0\n    files:\n      - path: /tmp/nmc/static/desired-states/node1.yaml\n        permissions: 384\n        owner: 0\n        group: 0\n        content: |\n          dns-resolver:\n            config:\n              server:\n              - 192.168.122.1\n              search: []\n          routes:\n            config:\n            - destination: 0.0.0.0/0\n              next-hop-interface: enp1s0\n              next-hop-address: 192.168.122.1\n              metric: 150\n              table-id: 254\n          interfaces:\n          - name: enp1s0\n            type: ethernet\n            state: up\n            mac-address: 52:54:00:45:14:c5\n            ipv4:\n              address:\n              - ip: 192.168.122.150\n                prefix-length: 24\n              enabled: true\n            ipv6:\n              enabled: false\n        encoding: ""\n        ownerstring: ""\n      - path: /tmp/nmc/static/desired-states/node2.yaml\n        permissions: 384\n        owner: 0\n        group: 0\n        content: |\n          dns-resolver:\n            config:\n              server:\n              - 192.168.122.1\n              search: []\n          routes:\n            config:\n            - destination: 0.0.0.0/0\n              next-hop-interface: enp1s0\n              next-hop-address: 192.168.122.1\n              metric: 150\n              table-id: 254\n          interfaces:\n          - name: enp1s0\n            type: ethernet\n            state: up\n            mac-address: 52:54:00:3a:ae:3b\n            ipv4:\n              address:\n              - ip: 192.168.122.151\n                prefix-length: 24\n              enabled: true\n            ipv6:\n              enabled: false\n        encoding: ""\n        ownerstring: ""\n    commands:\n    - nmc generate --config-dir /tmp/nmc/static/desired-states --output-dir /tmp/nmc/static/network-config\n    - nmc apply --config-dir /tmp/nmc/static/network-config\n',s={sidebar_label:"Static Configuration",title:""},a=void 0,c={id:"networking-static",title:"",description:"Static Network with nm-configurator",source:"@site/docs/networking-static.md",sourceDirName:".",slug:"/networking-static",permalink:"/next/networking-static",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{sidebar_label:"Static Configuration",title:""},sidebar:"docs",previous:{title:"IPAM Driven Networking",permalink:"/next/networking"},next:{title:"Cloud-config reference",permalink:"/next/cloud-config-reference"}},l={},d=[{value:"Static Network with nm-configurator",id:"static-network-with-nm-configurator",level:2}];function m(e){const n={a:"a",br:"br",code:"code",h2:"h2",p:"p",pre:"pre",...(0,o.R)(),...e.components},{CodeBlock:t,Head:s}=n;return t||u("CodeBlock",!0),s||u("Head",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s,{children:(0,i.jsx)("link",{rel:"canonical",href:"https://elemental.docs.rancher.com/networking"})}),"\n","\n","\n",(0,i.jsx)(n.h2,{id:"static-network-with-nm-configurator",children:"Static Network with nm-configurator"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"nm-configurator"})," ",(0,i.jsx)(n.a,{href:"https://github.com/suse-edge/nm-configurator?tab=readme-ov-file#per-node-configurations",children:"per node configuration"})," can be used to statically assign IP addresses to individual machines, based on the NIC's MAC addresses."]}),"\n",(0,i.jsx)(n.p,{children:"This solution does not require a remote IPAM provider, but requires the user to maintain mapping between known MAC addresses and IP Addresses."}),"\n",(0,i.jsxs)(n.p,{children:["In this example, we are going to customize an Elemental image, and include a ",(0,i.jsx)(n.a,{href:"/next/cloud-config-reference#configuration-syntax",children:"yip config"})," that will apply the static network config early at boot."]}),"\n",(0,i.jsx)(n.p,{children:"First we can create the yip config:"}),"\n",(0,i.jsx)(t,{language:"yaml",title:"99_static_network_config.yaml",showLineNumbers:!0,children:r}),"\n",(0,i.jsxs)(n.p,{children:["Second, we can extend an Elemental image to include this configuration in ",(0,i.jsx)(n.code,{children:"/system/oem"}),".",(0,i.jsx)(n.br,{}),"\n","Any Elemental powered OS, where ",(0,i.jsx)(n.a,{href:"https://github.com/rancher/elemental-toolkit",children:"Elemental Toolkit"})," is running, will evaluate any config in this directory when executing any stage."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-docker",metastring:"showLineNumbers",children:'# The version of Elemental to modify\nFROM registry.suse.com/suse/sl-micro/6.0/baremetal-os-container:latest\n\n# Install the static network config\nCOPY 99_static_network_config.yaml /system/oem/99_static_network_config.yaml\n\n# IMPORTANT: /etc/os-release is used for versioning/upgrade.\nARG IMAGE_REPO=norepo\nARG IMAGE_TAG=latest\nRUN \\\n    sed -i -e "s/^IMAGE_REPO=.*/IMAGE_REPO=\\"${IMAGE_REPO}\\"/g" /etc/os-release && \\\n    sed -i -e "s/^IMAGE_TAG=.*/IMAGE_TAG=\\"${IMAGE_TAG}\\"/g" /etc/os-release && \\\n    sed -i -e "s/^IMAGE=.*/IMAGE=\\"${IMAGE_REPO}:${IMAGE_TAG}\\"/g" /etc/os-release\n\n# IMPORTANT: it is good practice to recreate the initrd and re-apply `elemental-init`\nRUN elemental init --force immutable-rootfs,grub-config,dracut-config,cloud-config-essentials,elemental-setup\n'})}),"\n",(0,i.jsxs)(n.p,{children:["You can now ",(0,i.jsx)(n.a,{href:"/next/custom-images#create-a-custom-bootable-installation-iso",children:"build an ISO container"})," from this OS container image. For more information on how to customize Elemental images, please refer to the ",(0,i.jsx)(n.a,{href:"/next/custom-images",children:"documentation"}),".",(0,i.jsx)(n.br,{}),"\n","Once the ISO container is published on your registry, you can refer to it in the ",(0,i.jsx)(n.a,{href:"/next/seedimage-reference",children:"SeedImage"})," like any other Elemental distributed ISO image."]}),"\n",(0,i.jsxs)(n.p,{children:["Note that the static network config will be evaluated when the installation media boots, then it will be installed on the system, and finally it will follow the entire machine lifecycle.",(0,i.jsx)(n.br,{}),"\n","This also applies to ",(0,i.jsx)(n.a,{href:"/next/upgrade",children:"upgrades"}),", given that the static configuration is always included in upgrade images.",(0,i.jsx)(n.br,{}),"\n","None of the machine phases, from the very first boot, will require a DHCP server."]}),"\n",(0,i.jsxs)(n.p,{children:["Since the configuration is static, be aware that any change (for example to add new nodes) will require you to rebuild and republish your custom images, and rebuild the ",(0,i.jsx)(n.code,{children:"SeedImage"})," too to create a fresh installation media."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(m,{...e})}):m(e)}function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var i=t(96540);const o={},r=i.createContext(o);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);