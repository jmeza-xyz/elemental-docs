"use strict";(self.webpackChunkelemental_docs=self.webpackChunkelemental_docs||[]).push([[6032],{52904:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>o});var i=s(17624),t=s(4552);const a={sidebar_label:"Label Templates",title:""},r="Label Templates Overview",l={id:"label-templates",title:"",description:"Elemental allows to specify label templates in the spec.machineInventoryLabels section of the",source:"@site/docs/label-templates.md",sourceDirName:".",slug:"/label-templates",permalink:"/next/label-templates",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{sidebar_label:"Label Templates",title:""},sidebar:"docs",previous:{title:"Authentication",permalink:"/next/authentication"},next:{title:"SMBIOS",permalink:"/next/smbios"}},c={},o=[{value:"Label Template Variables",id:"label-template-variables",level:2},{value:"Sanitization",id:"sanitization",level:2},{value:"Usage of template labels",id:"usage-of-template-labels",level:2},{value:"Hardware data for the Elemental catalog",id:"hardware-data-for-the-elemental-catalog",level:3},{value:"Selectors for Cluster Provisioning",id:"selectors-for-cluster-provisioning",level:3},{value:"Custom Machine Names",id:"custom-machine-names",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,t.M)(),...e.components},{Head:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s,{children:(0,i.jsx)("link",{rel:"canonical",href:"https://elemental.docs.rancher.com/label-templates"})}),"\n",(0,i.jsx)(n.h1,{id:"label-templates-overview",children:"Label Templates Overview"}),"\n",(0,i.jsxs)(n.p,{children:["Elemental allows to specify ",(0,i.jsx)(n.em,{children:"label templates"})," in the ",(0,i.jsx)(n.code,{children:"spec.machineInventoryLabels"})," section of the\n",(0,i.jsx)(n.a,{href:"machineregistration-reference",children:"MachineRegistration"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Their format is the canonical ",(0,i.jsx)(n.code,{children:"key"}),":",(0,i.jsx)(n.code,{children:"value"})," used in Kubernetes labels."]}),"\n",(0,i.jsxs)(n.p,{children:["These label templates are converted to actual labels attached to each\n",(0,i.jsx)(n.a,{href:"machineinventory-reference",children:"MachineInventory"})," resources created during the\n",(0,i.jsx)(n.a,{href:"architecture-machineonboarding",children:"machine onboarding"})," phase."]}),"\n",(0,i.jsxs)(n.p,{children:["The resulting labels have the same ",(0,i.jsx)(n.code,{children:"key"})," of the label template."]}),"\n",(0,i.jsxs)(n.p,{children:["The associated ",(0,i.jsx)(n.code,{children:"value"})," is generated:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["rendering the ",(0,i.jsx)(n.a,{href:"#label-template-variables",children:(0,i.jsx)(n.code,{children:"label template variables"})})]})," (if present)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"sanitizing"})})," the resulting value"]}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.p,{children:["The Elemental templating functionality covers also the [MachineRegistration] ",(0,i.jsx)(n.code,{children:"spec.machineName"})," field,\nwhich defines the resulting hostname of the registering machine and the ",(0,i.jsx)(n.code,{children:"name"})," of the associated\n",(0,i.jsx)(n.a,{href:"machineinventory-reference",children:"MachineInventory"})," resource."]}),(0,i.jsxs)(n.p,{children:["See the ",(0,i.jsx)(n.a,{href:"#custom-machine-names",children:"Machine Name"})," section for more details."]})]}),"\n",(0,i.jsx)(n.h2,{id:"label-template-variables",children:"Label Template Variables"}),"\n",(0,i.jsxs)(n.p,{children:["Elemental Label Templating includes a set of predefined variables that could be used inside the ",(0,i.jsx)(n.code,{children:"value"})," of\nthe ",(0,i.jsx)(n.em,{children:"label templates"})," specified in the ",(0,i.jsx)(n.a,{href:"machineregistration-reference",children:"MachineRegistration"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"The syntax used to specify template variables is:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["${ ",(0,i.jsx)(n.em,{children:"VARFAMILY"})," / ",(0,i.jsx)(n.em,{children:"VARPATH"})," }"]})}),"\n",(0,i.jsxs)(n.p,{children:["where ",(0,i.jsx)(n.em,{children:"VARFAMILY"})," defines a group (family) of supported variables and ",(0,i.jsx)(n.em,{children:"VARPATH"})," defines the actual variable\nname inside the belonging family group."]}),"\n",(0,i.jsx)(n.p,{children:"Elemental currently supports three families of template variables:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SMBIOS"}),":  ",(0,i.jsx)(n.strong,{children:"${ System Information /"})," ",(0,i.jsx)(n.em,{children:"VARPATH"})," ",(0,i.jsx)(n.strong,{children:"}"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"HARDWARE"}),":  ",(0,i.jsx)(n.strong,{children:"${ System Data /"})," ",(0,i.jsx)(n.em,{children:"VARPATH"})," ",(0,i.jsx)(n.strong,{children:"}"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RANDOM"}),":  ",(0,i.jsx)(n.strong,{children:"${ Random /"})," ",(0,i.jsx)(n.em,{children:"VARPATH"})," ",(0,i.jsx)(n.strong,{children:"}"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Template variables can be mixed with static text to form the actual labels assigned to\n(",(0,i.jsx)(n.a,{href:"machineinventory-reference",children:"MachineInventories"}),")."]}),"\n",(0,i.jsx)(n.admonition,{title:"Rendering Examples",type:"note",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Template label tracking the number of CPU cores of the registering host (assume host has 4 cores):","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["template label: ",(0,i.jsx)(n.strong,{children:"cpu: ${System Data/CPU/Total Cores}-cores"})]}),"\n",(0,i.jsxs)(n.li,{children:["rendered label: ",(0,i.jsx)(n.strong,{children:"cpu: 4-cores"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Template label to track the SMBIOS UUID of the registering host:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["template label: ",(0,i.jsx)(n.strong,{children:"sbios-UUID: ${System Information/UUID}"})]}),"\n",(0,i.jsxs)(n.li,{children:["rendered label: ",(0,i.jsx)(n.strong,{children:"sbios-UUID: fd95324a-c26b-4e28-8727-1dcec293a0ec"})]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,i.jsx)(n.h2,{id:"sanitization",children:"Sanitization"}),"\n",(0,i.jsxs)(n.p,{children:["Once the label template value has been rendered accordingly to the included ",(0,i.jsx)(n.a,{href:"#label-template-variables",children:"label template variables"}),", the resulting value is ",(0,i.jsx)(n.code,{children:"sanitized"})," before being assigned to the resulting label."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["The ",(0,i.jsx)(n.code,{children:"sanitization"})," enforce the label value to only contain letters (capitalized or not), numbers and the hyphen (",(0,i.jsx)(n.code,{children:"-"}),"), point (",(0,i.jsx)(n.code,{children:"."}),") and underscore (",(0,i.jsx)(n.code,{children:"_"}),") characters"]}),":\nall the characters not included are substituted with an underscore."]}),"\n",(0,i.jsx)(n.p,{children:"If an underscore is at the beginning or at the end of the label value, it is dropped."}),"\n",(0,i.jsx)(n.p,{children:"Two consecutive underscores are replaced with one."}),"\n",(0,i.jsx)(n.admonition,{title:"Rendering Example",type:"note",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Template label with not allowed chars sanitization:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["template label: ",(0,i.jsxs)(n.strong,{children:["sanitized: this",":needs--sanitizing","!"]})]}),"\n",(0,i.jsxs)(n.li,{children:["rendered label: ",(0,i.jsx)(n.strong,{children:"sanitized: this-needs-sanitizing"})]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,i.jsx)(n.h2,{id:"usage-of-template-labels",children:"Usage of template labels"}),"\n",(0,i.jsxs)(n.p,{children:["Template labels allow to automatically attach labels to each host's\n",(0,i.jsx)(n.a,{href:"machineinventory-reference",children:"MachineInventory"})," every time an host register to the Elemental Operator."]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["Registration happens not only during the ",(0,i.jsx)(n.a,{href:"architecture-machineonboarding",children:"onboarding phase"}),": each host\nre-registers every 30 minutes (and every time it reboots).\nDuring the re-registration, the template labels in the associated\n",(0,i.jsx)(n.a,{href:"machineregistration-reference",children:"MachineRegistration"})," are re-evaluated and added/updated in the\n",(0,i.jsx)(n.a,{href:"machineinventory-reference",children:"MachineInventory"}),"."]})}),"\n",(0,i.jsx)(n.p,{children:"There are basically three main cases where the template labels are handy:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"as hardware data added to the Elemental catalog"}),"\n",(0,i.jsx)(n.li,{children:"as selectors for Cluster Provisioning"}),"\n",(0,i.jsx)(n.li,{children:"as template for custom Machine Names"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"hardware-data-for-the-elemental-catalog",children:"Hardware data for the Elemental catalog"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{href:"smbios",children:"SMBIOS"})," and ",(0,i.jsx)(n.a,{href:"hardwarelabels",children:"Hardware"})," template variables can be used to attach to each\n",(0,i.jsx)(n.a,{href:"machineinventory-reference",children:"MachineInventory"})," hardware and system data of each host."]}),"\n",(0,i.jsx)(n.h3,{id:"selectors-for-cluster-provisioning",children:"Selectors for Cluster Provisioning"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"template labels"})," can be used to indentify and select machines with special properties to form\na new Kubernetes Cluster."]}),"\n",(0,i.jsxs)(n.p,{children:["The labels generated for each ",(0,i.jsx)(n.a,{href:"machineinventory-reference",children:"MachineInventory"})," are an handy selector for the\n",(0,i.jsx)(n.a,{href:"machineinventoryselectortemplate-reference",children:"MachineInventorySelectorTemplate"})," resource\n(see the ",(0,i.jsx)(n.a,{href:"architecture-clusterdeployment#kubernetes-cluster-provisioning",children:"Kubernetes Cluster provisioning"}),"\nsection for more details)."]}),"\n",(0,i.jsx)(n.h3,{id:"custom-machine-names",children:"Custom Machine Names"}),"\n",(0,i.jsxs)(n.p,{children:["The hostname of the onboarding machine can be specified using the\n",(0,i.jsx)(n.a,{href:"machineregistration-reference",children:"MachineRegistration"})," ",(0,i.jsx)(n.code,{children:"spec.machineName"})," field."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"spec.machineName"})," value undergoes the same ",(0,i.jsx)(n.code,{children:"label templates variables"})," and ",(0,i.jsx)(n.code,{children:"sanitization"})," process reserved\nto the ",(0,i.jsx)(n.code,{children:"spec.machineInventoryLabels"})," label values."]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["There is one notable difference during the ",(0,i.jsx)(n.a,{href:"#sanitization",children:"sanitization"})," rendering: the underscore (",(0,i.jsx)(n.code,{children:"_"}),") is\nnot allowed and is dealt as the other forbidden characters (i.e., it is substituted by an hyphen: ",(0,i.jsx)(n.code,{children:"-"}),").\nThis is required as the underscore is not allowed in the OS hostnames."]})}),"\n",(0,i.jsxs)(n.p,{children:["For more information on how to define the hostname for Elemental hosts, see the\n",(0,i.jsx)(n.a,{href:"hostname",children:"HowTo/Customize hostname"})," section."]}),"\n",(0,i.jsx)(n.admonition,{title:"Rendering Example",type:"note",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Define an hostname template like ",(0,i.jsx)(n.code,{children:"SLE-Micro-[random string of 6 hexadecimal values]"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["MachineRegistration spec: ",(0,i.jsx)(n.strong,{children:"machineName: SLE-Micro-${Random/Hex/6}"})]}),"\n",(0,i.jsxs)(n.li,{children:["MachineInventory name: ",(0,i.jsx)(n.strong,{children:"SLE-Micro-32ad41"})]}),"\n"]}),"\n"]}),"\n"]})})]})}function d(e={}){const{wrapper:n}={...(0,t.M)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},4552:(e,n,s)=>{s.d(n,{I:()=>l,M:()=>r});var i=s(11504);const t={},a=i.createContext(t);function r(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);