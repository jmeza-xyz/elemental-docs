"use strict";(self.webpackChunkelemental_docs=self.webpackChunkelemental_docs||[]).push([[6892],{54084:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var t=a(17624),l=a(4552);const i={sidebar_label:"Air-Gapped Installation",title:""},r=void 0,s={id:"airgap",title:"",description:"Install Elemental in an Air-Gapped Environment",source:"@site/docs/airgap.md",sourceDirName:".",slug:"/airgap",permalink:"/next/airgap",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{sidebar_label:"Air-Gapped Installation",title:""},sidebar:"docs",previous:{title:"Add a custom certificate",permalink:"/next/custom-certificate"},next:{title:"Building raw disk images for Raspberry Pi",permalink:"/next/raspi-disk"}},o={},c=[{value:"Install Elemental in an Air-Gapped Environment",id:"install-elemental-in-an-air-gapped-environment",level:2},{value:"Assumptions",id:"assumptions",level:3},{value:"Overview",id:"overview",level:3},{value:"Elemental Air-Gapped installation from the command line",id:"elemental-air-gapped-installation-from-the-command-line",level:3},{value:"Elemental installation",id:"elemental-installation",level:4},{value:"Elemental Air-Gapped installation from the Rancher Marketplace",id:"elemental-air-gapped-installation-from-the-rancher-marketplace",level:3},{value:"Elemental installation",id:"elemental-installation-1",level:4},{value:"Elemental UI Extension",id:"elemental-ui-extension",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.M)(),...e.components},{Head:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i,{children:(0,t.jsx)("link",{rel:"canonical",href:"https://elemental.docs.rancher.com/airgap"})}),"\n",(0,t.jsx)(n.h2,{id:"install-elemental-in-an-air-gapped-environment",children:"Install Elemental in an Air-Gapped Environment"}),"\n",(0,t.jsx)(n.h3,{id:"assumptions",children:"Assumptions"}),"\n",(0,t.jsxs)(n.p,{children:["A Rancher air-gapped installation should be already configured as per the ",(0,t.jsx)(n.a,{href:"https://ranchermanager.docs.rancher.com/pages-for-subheaders/air-gapped-helm-cli-install",children:"official Rancher documentation"}),".\nIn particular, a private registry should be available in the air-gapped infrastructure."]}),"\n",(0,t.jsx)(n.h3,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"In order to run Elemental in an air-gapped environment the following artifacts are needed:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"the Elemental Operator charts"}),"\n",(0,t.jsxs)(n.li,{children:["the container images referenced in the charts (the ",(0,t.jsx)(n.em,{children:"elemental-operator"})," and ",(0,t.jsx)(n.em,{children:"seedimage-builder"})," images)"]}),"\n",(0,t.jsx)(n.li,{children:"the containerized OS images"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Moreover, it could be handy to create a ",(0,t.jsx)(n.em,{children:"channel image"})," referencing the containerized OS images available.\nThe official channel image (the ",(0,t.jsx)(n.em,{children:"elemental-channel"})," one) references absolute URLs of the OS images on the official suse registry, so it cannot be used as-is in an air-gapped scenario."]}),"\n",(0,t.jsx)(n.h3,{id:"elemental-air-gapped-installation-from-the-command-line",children:"Elemental Air-Gapped installation from the command line"}),"\n",(0,t.jsxs)(n.p,{children:["All the required steps can be accomplished by executing the\n",(0,t.jsxs)(n.a,{href:"https://raw.githubusercontent.com/rancher/elemental-operator/main/scripts/elemental-airgap.sh",children:[(0,t.jsx)(n.code,{children:"elemental-airgap.sh"})," script"]}),"\nfrom a host with Internet access."]}),"\n",(0,t.jsxs)(n.p,{children:["The Elemental charts are a required parameter to the script and can be provided as downloaded archives, URLs or as one of\nthe ",(0,t.jsx)(n.code,{children:"stable"}),", ",(0,t.jsx)(n.code,{children:"staging"})," and ",(0,t.jsx)(n.code,{children:"dev"})," keywords, to let the script retrieve the correct chart version for you."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"elemental-airgap.sh"})," inspects the Elemental Operator chart, identifies all the required container images, downloads and saves them in a single docker archive.\nIt also builds a new OS channel image with the OS image URLs pointing to the private registry passed as argument\n(which is a mandatory argument too)."]}),"\n",(0,t.jsx)(n.p,{children:"As an example, to download all the artifacts and build a custom channel from the latest stable release of Elemental:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",metastring:"showLineNumbers",children:"wget https://raw.githubusercontent.com/rancher/elemental-operator/main/scripts/elemental-airgap.sh\nchmod 755 elemental-airgap.sh\n./elemental-airgap.sh stable -r <REGISTRY.YOURDOMAIN.COM:PORT>\n"})}),"\n",(0,t.jsx)(n.p,{children:"once completed (the script may take a while) the following files will be available in the current dir:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"elemental-operator-crds-chart-<*VERSION*>.tgz"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"elemental-operator-chart-<*VERSION*>.tgz"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"elemental-images.txt"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"elemental-images.tar.gz"})}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"elemental-installation",children:"Elemental installation"}),"\n",(0,t.jsx)(n.p,{children:"All the above files should be copied to a host which:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Has access to the private registry."}),"\n",(0,t.jsx)(n.li,{children:"Has the kubectl binary installed and configured to access the air-gapped Rancher cluster."}),"\n",(0,t.jsx)(n.li,{children:"Has the helm binary installed."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"If the private registry requires authentication you need to log with docker into it:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shellnocolor",metastring:"showLineNumbers",children:"docker login <REGISTRY.YOURDOMAIN.COM:PORT>\n"})}),"\n",(0,t.jsx)(n.p,{children:"Two steps are needed to perform the Elemental installation:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["load the archive with all the required container images on the private registry:\nthis could be done using the ",(0,t.jsx)(n.code,{children:"rancher-load-images.sh"})," script distributed with the Rancher release and already used for the Rancher air-gapped deployment:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shellnocolor",metastring:"showLineNumbers",children:"rancher-load-images.sh \\\n   --image-list elemental-images.txt \\\n   --images elemental-images.tar.gz \\\n   --registry <REGISTRY.YOURDOMAIN.COM:PORT>\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"install the downloaded elemental charts configuring the local registry and the newly created channel:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shellnocolor",metastring:"showLineNumbers",children:"helm upgrade --create-namespace -n cattle-elemental-system \\\n  --install elemental-operator-crds elemental-operator-crds-chart-<VERSION>.tgz\n\nhelm upgrade --create-namespace -n cattle-elemental-system \\\n  --install elemental-operator elemental-operator-chart-<VERSION>.tgz \\\n  --set registryUrl=<REGISTRY.YOURDOMAIN.COM:PORT> \\\n  --set channel.repository=rancher/elemental-teal-channel-<REGISTRY.YOURDOMAIN.COM>\n"})}),"\n",(0,t.jsx)(n.admonition,{title:"The elemental airgap script outputs the required commands",type:"info",children:(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"elemental-airgap.sh"})," scripts prints out the required commands shown above but using the actual chart version and the provided registry URL to allow to easily copy and paste the exact commands."]})}),"\n",(0,t.jsx)(n.h3,{id:"elemental-air-gapped-installation-from-the-rancher-marketplace",children:"Elemental Air-Gapped installation from the Rancher Marketplace"}),"\n",(0,t.jsx)(n.p,{children:"A Rancher air-gapped installation includes also the Elemental Operator charts and the operator and seedimage container\nimages."}),"\n",(0,t.jsxs)(n.p,{children:["To collect the missing OS images and to build an OS channel image for your private registry execute the\n",(0,t.jsxs)(n.a,{href:"https://raw.githubusercontent.com/rancher/elemental-operator/main/scripts/elemental-airgap.sh",children:[(0,t.jsx)(n.code,{children:"elemental-airgap.sh"})," script"]}),"\nfrom an host with Internet access, using the ",(0,t.jsx)(n.code,{children:"-co"})," option."]}),"\n",(0,t.jsxs)(n.p,{children:["As an example, let's target the ",(0,t.jsx)(n.code,{children:"elemental-channel"})," image from the latest stable release of Elemental.\nThe script will take care of downloading the Elemental operator chart (if needed), extract the OS channel image URL,\ndownload it, inspect all the OS images referenced, download all of them and create a new OS channel with links to the\nprivate registry of the air-gapped scenario."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",metastring:"showLineNumbers",children:"wget https://raw.githubusercontent.com/rancher/elemental-operator/main/scripts/elemental-airgap.sh\nchmod 755 elemental-airgap.sh\n./elemental-airgap.sh stable -co -r <REGISTRY.YOURDOMAIN.COM:PORT>\n"})}),"\n",(0,t.jsx)(n.p,{children:"once completed (the script may take a while) the following files will be available in the current dir:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"elemental-operator-crds-chart-<*VERSION*>.tgz"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"elemental-operator-chart-<*VERSION*>.tgz"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"elemental-images.txt"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"elemental-images.tar.gz"})}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"elemental-installation-1",children:"Elemental installation"}),"\n",(0,t.jsxs)(n.p,{children:["The generated ",(0,t.jsx)(n.code,{children:"elemental-images.tar.gz"})," archive should be loaded to the air-gapped private registry."]}),"\n",(0,t.jsxs)(n.p,{children:["The script will print out the commands required to load the images via the Rancher ",(0,t.jsx)(n.code,{children:"rancher-load-images.sh"})," tool, used\nfor the Rancher air-gapped installations. It should be something like:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",metastring:"showLineNumbers",children:"NEXT STEPS:\n\n1) Load the 'elemental-images.tar.gz' to the local registry (<REGISTRY.YOURDOMAIN.COM:PORT>)\n   available in the airgapped infrastructure:\n\n./rancher-load-images.sh \\\n   --image-list elemental-images.txt \\\n   --images elemental-images.tar.gz \\\n   --registry <REGISTRY.YOURDOMAIN.COM:PORT>\n"})}),"\n",(0,t.jsx)(n.p,{children:"Once the OS and channel images are loaded, you should skip the point 2 from the script output\n(which will install the Elemental charts from the downloaded archives)\nand instead perform the Elemental Operator installation from the Rancher UI."}),"\n",(0,t.jsxs)(n.p,{children:["When requested, put the full path of the OS channel image just uploaded in your private registry:\n",(0,t.jsx)(n.img,{alt:"Elemental OS Channel",src:a(47216).c+"",width:"1469",height:"650"})]}),"\n",(0,t.jsx)(n.h3,{id:"elemental-ui-extension",children:"Elemental UI Extension"}),"\n",(0,t.jsx)(n.p,{children:"Rancher 2.7.x doesn't support UI extensions plugin in air-gapped environments, and so the Elemental UI is not available in Rancher 2.7.x."}),"\n",(0,t.jsx)(n.p,{children:"The Elemental UI plugin will be present in the available UI extensions in Rancher 2.8.0."})]})}function d(e={}){const{wrapper:n}={...(0,l.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},47216:(e,n,a)=>{a.d(n,{c:()=>t});const t=a.p+"assets/images/airgap-os-channel-image-cb09ee2dc30f77307d5d531796704e6c.png"},4552:(e,n,a)=>{a.d(n,{I:()=>s,M:()=>r});var t=a(11504);const l={},i=t.createContext(l);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);